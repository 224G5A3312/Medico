<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Medical AI Assistant</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css')}}?v=3"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
      body{font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(135deg,#0b0f13,#0b0f13 60%,rgba(34,197,94,.08));}
      .brand-pill{background:#dc2626;border-radius:9999px;box-shadow:0 6px 18px rgba(220,38,38,.35)}
      .card-soft{background:linear-gradient(180deg,rgba(23,23,23,.9),rgba(23,23,23,.8));backdrop-filter:blur(6px);border:0}
      .disclaimer{background:rgba(245,158,11,.12);border:1px solid rgba(245,158,11,.35)}
      .disclaimer p{margin-bottom:0}
      .avatar{width:40px;height:40px;border-radius:9999px;overflow:hidden;border:2px solid rgba(220,38,38,.25);box-shadow:0 2px 6px rgba(0,0,0,.25)}
      .bubble-bot{background:#0ea5e9;color:#fff;border-radius:18px 18px 6px 18px}
      .bubble-user{background:#16a34a;color:#fff;border-radius:18px 6px 18px 18px}
      .typing-dot{width:8px;height:8px;background:#fff;border-radius:9999px;opacity:.8;animation: blink 1.2s infinite}
      .typing-dot:nth-child(2){animation-delay:.2s}.typing-dot:nth-child(3){animation-delay:.4s}
      @keyframes blink{0%,80%,100%{opacity:.2}40%{opacity:1}}
      .toggle-theme{border-color:rgba(220,38,38,.25)}
      .toggle-theme:hover{background:rgba(220,38,38,.12)}
    </style>
  </head>
  <body data-theme="dark">
    <div class="container py-4" style="max-width: 960px;">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="d-flex align-items-center">
          <div class="brand-pill p-2 mr-3"><i class="fas fa-stethoscope text-white"></i></div>
          <div>
            <h1 class="h4 mb-0 text-white">Medical AI Assistant</h1>
            <small class="text-muted">Professional health guidance</small>
          </div>
        </div>
        <button id="themeToggle" class="btn btn-sm btn-outline-light toggle-theme" title="Toggle theme">
          <i id="themeIcon" class="fas fa-moon"></i>
        </button>
      </div>

      <!-- Disclaimer -->
      <div class="disclaimer rounded p-3 mb-3">
        <div class="d-flex align-items-start">
          <i class="fas fa-exclamation-triangle mr-2" style="color:#f59e0b"></i>
          <div class="text-warning">
            <strong class="d-block mb-1">Medical Disclaimer</strong>
            <p class="text-warning">This AI provides general health information and is not a substitute for professional medical advice, diagnosis, or treatment.</p>
          </div>
        </div>
      </div>

      <!-- Chat Card -->
      <div class="card card-soft shadow-lg">
        <div id="messageFormeight" class="card-body" style="height:500px;overflow-y:auto;">
          <!-- Welcome (Bot) -->
          <div class="d-flex mb-3">
            <div class="avatar mr-2"><img src="https://cdn-icons-png.flaticon.com/512/387/387569.png" class="w-100 h-100"/></div>
            <div style="max-width:65%">
              <div class="bubble-bot px-3 py-2 shadow-sm">
                <small>
                  Hello! üëã I'm Dr. AI, your medical assistant. I can provide general health information and guidance.
                  <br/><br/>‚ö†Ô∏è <strong>Important:</strong> I‚Äôm not a substitute for professional care.
                  <br/><br/>How can I help you today?
                </small>
              </div>
              <div class="text-muted small mt-1">9:30 AM</div>
            </div>
          </div>
        </div>
        <div class="card-footer">
          <form id="messageArea" class="input-group">
            <input type="text" id="text" name="msg" placeholder="Type your health question here..." autocomplete="off" class="form-control" required/>
            <div class="input-group-append">
              <button type="submit" id="send" class="btn btn-success"><i class="fas fa-paper-plane"></i></button>
            </div>
          </form>
        </div>
      </div>

      <!-- Footer -->
      <div class="text-center mt-3 text-muted small">¬© 2024 Medical AI Assistant ‚Ä¢ For educational purposes only</div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
      $(function(){
        const body = document.body;
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const savedTheme = localStorage.getItem('theme') || 'dark';
        body.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);
        themeToggle.addEventListener('click', function(){
          const t = body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
          body.setAttribute('data-theme', t); localStorage.setItem('theme', t); updateThemeIcon(t);
        });
        function updateThemeIcon(t){ themeIcon.className = t === 'dark' ? 'fas fa-moon' : 'fas fa-sun'; }

        $('#messageArea').on('submit', function(e){
          e.preventDefault();
          const date = new Date();
          const ts = date.getHours()+":"+String(date.getMinutes()).padStart(2,'0');
          const rawText = $('#text').val();
          if(!rawText.trim()) return;
          const userHtml = `
            <div class="d-flex justify-content-end mb-3">
              <div style="max-width:65%">
                <div class="bubble-user px-3 py-2 shadow-sm"><small>${$('<div>').text(rawText).html()}</small></div>
                <div class="text-muted small mt-1 text-right">${ts}</div>
              </div>
              <div class="avatar ml-2"><img src="https://i.ibb.co/d5b84Xw/Untitled-design.png" class="w-100 h-100"/></div>
            </div>`;
          $('#text').val('');
          $('#messageFormeight').append(userHtml).scrollTop($('#messageFormeight')[0].scrollHeight);

          $.ajax({type:'POST', url:'/get', data:{msg: rawText}}).done(function(data){
            const botHtml = `
              <div class="d-flex mb-3">
                <div class="avatar mr-2"><img src="https://cdn-icons-png.flaticon.com/512/387/387569.png" class="w-100 h-100"/></div>
                <div style="max-width:65%">
                  <div class="bubble-bot px-3 py-2 shadow-sm"><small>${data}</small></div>
                  <div class="text-muted small mt-1">${ts}</div>
                </div>
              </div>`;
            $('#messageFormeight').append(botHtml).scrollTop($('#messageFormeight')[0].scrollHeight);
          });
        });
      });
    </script>
  </body>
</html>